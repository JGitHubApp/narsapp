<!doctype html>
<html lang='en'>
	<head>
		<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
		<script src='../js/fullscreen.js' type='text/javascript'></script>
		<meta name='viewport' content='initial-scale=1.0, width=device-width' />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<!--<link href='http://fonts.googleapis.com/css?family=Oxygen' rel='stylesheet' type='text/css'>-->
		<link rel='icon' href="http://nars.graphicselite.com/favicon/icon-256.png" sizes="256x256" type="image/png" />
		<link rel='icon' href="http://nars.graphicselite.com/favicon/icon-128.png" sizes="128x128" type="image/png" />
		<link rel='icon' href="http://nars.graphicselite.com/favicon/icon-64.png" sizes="64x64" type="image/png" />
		<link rel='icon' href="http://nars.graphicselite.com/favicon/icon-48.png" sizes="48x48" type="image/png" />
		<link rel='icon' href="http://nars.graphicselite.com/favicon/icon-32.png" sizes="32x32" type="image/png" />
		<link rel="shortcut icon" href="/favicon.ico" type='image/x-icon' />

		<title>NARS Flash Cards</title>

		<link href='../css/styles.css' rel='stylesheet' type='text/css' />
		<link href='../css/flashCard2.css' rel='stylesheet' type='text/css' />
  </head>
  <body onload='drawSignal(signalArray[0][0], ruleArray[0]); resizeFlashCard()'>
		<div id="container">
			<table id='flashCardContainer'>
				<tr>
					<td>
						<div id='flashCard'>
							<canvas id='frontFlashCard' class='side' width='600' height='400'></canvas>
							<div id='backFlashCard' class='side'>
								<h1 id='signalRule'></h1>
								<h2>Name</h2>
								<p id='signalName'></p>
								<h2>Indication</h2>
								<p id='signalIndication'></p>
							</div>
						</div>
					<td>
				</tr>
			</table>

			<a id='backButton' href='learningTools.html'><img class='button' alt='Back' src='../images/icons/glossy-black-icon-arrows-arrow-styled-left.png' alt='Back' /></a>
		</div>

		<script src='../js/flashCard.js' type='text/javascript' defer></script>
		<script src='../js/flashCardSignals.js' type='text/javascript' defer></script>
		<script src='../js/flashCardAnimations.js' type='text/javascript' defer></script>

		<script>
			window.addEventListener('keydown', function(event) {
					switch (event.which) {
						case 37: // LEFT
							animateCard('left');
							break;
						case 39: // RIGHT
							animateCard('right');
							break;
						case 38: // UP
							animateCard('up');
							break;
						case 40: // DOWN
							animateCard('down');
							break;
					}
				}, false);

			var touchX = null;
			var touchY = null;
			var tiltDirection = null;
			var previousTilt = null;

			// If touch events are supported
			if ('ontouchstart' in window) {
				window.addEventListener('touchstart', function() {
					touchX = event.touches[0].pageX;
					touchY = event.touches[0].pageY;

					if ( touchX >= fc.offsetLeft &&
							touchX <= fc.offsetLeft + fc.offsetWidth &&
							touchY >= fc.offsetTop &&
							touchY <= fc.offsetTop + fc.offsetHeight) {
						event.preventDefault();
						previousTilt = fc.style[transformType];
					}
					else {
						touchX = null;
						touchY = null;
					}
				});

				window.addEventListener('touchend', function() {
					if (touchX != null && touchY != null) {
						fc.style[transformType]  = previousTilt;

						var endX = event.changedTouches[0].pageX;
						var endY = event.changedTouches[0].pageY;
						var bb = document.getElementById('backButton').getElementsByTagName('img')[0];

						// If swipe length is long enough
						//if (Math.sqrt(Math.pow(touchX - endX, 2) + Math.pow(touchY - endY, 2)) > 50) {
						if (Math.abs(endX - touchX) > 50 || Math.abs(endY - touchY) > 50) {
							event.preventDefault();
							animateCard(swipeDirection(endX, endY));
						}
						else if ( // On return button
								touchX >= bb.offsetLeft &&
								touchX <= bb.offsetLeft + bb.offsetWidth &&
								touchY >= bb.offsetTop &&
								touchY <= bb.offsetTop + bb.offsetHeight) {

							location.href = document.getElementById('backButton').href;
						}

						tiltDirection = null;
						previousTilt = null;
					}
				});

				function swipeDirection(endX, endY) {
					var strDirection = '';

					if (Math.abs(touchX - endX) > Math.abs(touchY - endY))
						if (touchX > endX)
							strDirection = 'left';
						else
							strDirection = 'right';
					else
						if (touchY > endY)
							strDirection = 'up';
						else
							strDirection = 'down';

					return strDirection;
				}
			}

			var animateCard;
			if ('classList' in document.body) {
				animateCard = function(direction) {
					switch (direction) {
						case 'left':
						case 'right':
							flipCard(direction);
							break;
						case 'up':
							fc.classList.add('moveUp');
							var t1 = setTimeout(goNextCard, 250);
							var t2 = setTimeout(function() {fc.classList.remove('moveUp');}, 500);
							break;
						case 'down':
							fc.classList.add('moveDown');
							var t1 = setTimeout(goBackCard, 250);
							var t2 = setTimeout(function() {fc.classList.remove('moveDown');}, 500);
							break;
					}
				}

				window.addEventListener('touchmove', function() {
					if (touchX != null && touchY != null) {
						event.preventDefault();

						var curX = event.touches[0].pageX;
						var curY = event.touches[0].pageY;

						// If tilt direction has changed
						if (tiltDirection != swipeDirection(curX, curY)) {
							// Reset Tilt
							fc.style[transformType]  = previousTilt;
							distX = Math.abs(curX - touchX);

							// If length of swipe is long enough
							if (distX > 50) {
								tiltDirection = swipeDirection(curX, curY);
								var tiltAmount = 20;

								switch (tiltDirection) {
									case 'left':
										tiltAmount = degreesFlipped - tiltAmount;
										fc.style[transformType]  = 'rotateY(' + tiltAmount + 'deg)';
										break;
									case 'right':
										tiltAmount = degreesFlipped + tiltAmount;
										fc.style[transformType]  = 'rotateY(' + tiltAmount + 'deg)';
										break;
								}
							}
						}
					}
				});
			}
			else {
				animateCard = function(direction) {
					switch (direction) {
						case 'left':
						case 'right':
							flipCard(direction);
							break;
						case 'up':
							goNextCard();
							break;
						case 'down':
							goBackCard();
							break;
					}
				}
			}
		</script>
  </body>
</html>
