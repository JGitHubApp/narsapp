<!doctype html>
<html lang='en'>
	<head>
		<meta http-equiv='Content-Type' content='text/html; charset=UTF-8' />
		<script src='../js/fullscreen.js' type='text/javascript'></script>
		<meta name='viewport' content='initial-scale=1.0, width=device-width' />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<!--<link href='http://fonts.googleapis.com/css?family=Oxygen' rel='stylesheet' type='text/css'>-->
		<link rel='icon' href="http://nars.graphicselite.com/favicon/icon-256.png" sizes="256x256" type="image/png" />
		<link rel='icon' href="http://nars.graphicselite.com/favicon/icon-128.png" sizes="128x128" type="image/png" />
		<link rel='icon' href="http://nars.graphicselite.com/favicon/icon-64.png" sizes="64x64" type="image/png" />
		<link rel='icon' href="http://nars.graphicselite.com/favicon/icon-48.png" sizes="48x48" type="image/png" />
		<link rel='icon' href="http://nars.graphicselite.com/favicon/icon-32.png" sizes="32x32" type="image/png" />
		<link rel="shortcut icon" href="/favicon.ico" type='image/x-icon' />

		<title>NARS Flash Cards</title>

		<link href='../css/styles.css' rel='stylesheet' type='text/css' />
		<link href='../css/flashCard2.css' rel='stylesheet' type='text/css' />
  </head>
  <body onload='drawSignal(signalArray[0][0], ruleArray[0]); resizeFlashCard()'>
		<div id="container">
			<table id='flashCardContainer'>
				<tr>
					<td>
						<div id='flashCard'>
							<canvas id='frontFlashCard' class='side' width='600' height='400'></canvas>
							<div id='backFlashCard' class='side'>
								<h1 id='signalRule'></h1>
								<h2>Name</h2>
								<p id='signalName'></p>
								<h2>Indication</h2>
								<p id='signalIndication'></p>
							</div>
						</div>
					<td>
				</tr>
			</table>

			<a href='learningTools.html'><img id='return' class='button' alt='Return to Learning Tools' src='../images/icons/glossy-black-icon-arrows-arrow-styled-left.png' alt='Back' /></a>
		</div>

		<script src='../js/flashCard.js' type='text/javascript' defer></script>
		<script src='../js/flashCardSignals.js' type='text/javascript' defer></script>
		<script src='../js/flashCardAnimations.js' type='text/javascript' defer></script>

		<script>
			window.addEventListener('keydown', function() {
					switch (event.which) {
						case 37: // LEFT
							animateCard('left');
							break;
						case 39: // RIGHT
							animateCard('right');
							break;
						case 38: // UP
							animateCard('up');
							break;
						case 40: // DOWN
							animateCard('down');
							break;
					}
				});

			var touchX = null;
			var touchY = null;

			// If touch events are supported
			if ('ontouchstart' in window) {
				window.addEventListener('touchstart', function() {
					touchX = event.touches[0].pageX;
					touchY = event.touches[0].pageY;

					var rb = document.getElementById('return');

					if ( touchX >= fc.offsetLeft &&
							touchX <= fc.offsetLeft + fc.offsetWidth &&
							touchY >= fc.offsetTop &&
							touchY <= fc.offsetTop + fc.offsetHeight) {
						event.preventDefault();
					}
					else {
						touchX = null;
						touchY = null;
					}
				});

				window.addEventListener('touchend', function() {
					if (touchX != null && touchY != null) {
						var endX = event.changedTouches[0].pageX;
						var endY = event.changedTouches[0].pageY;
						var rb = document.getElementById('return');

						// If swipe length is long enough
						//if (Math.sqrt(Math.pow(touchX - endX, 2) + Math.pow(touchY - endY, 2)) > 50) {
						if (Math.abs(endX - touchX) > 50 || Math.abs(endY - touchY) > 50) {
							event.preventDefault();
							animateCard(swipeDirection(endX, endY));
						}
						else if ( // On return button
								touchX >= rb.offsetLeft &&
								touchX <= rb.offsetLeft + rb.offsetWidth &&
								touchY >= rb.offsetTop &&
								touchY <= rb.offsetTop + rb.offsetHeight)
							rb.click();
					}
				});

				function swipeDirection(endX, endY) {
					var strDirection = '';

					if (Math.abs(touchX - endX) > Math.abs(touchY - endY))
						if (touchX > endX)
							strDirection = 'left';
						else
							strDirection = 'right';
					else
						if (touchY > endY)
							strDirection = 'up';
						else
							strDirection = 'down';

					return strDirection;
				}
			}

			function animateCard(direction) {
					switch (direction) {
						case 'left':
						case 'right':
							flipCard(direction);
							break;
						case 'up':
							fc.classList.add('moveUp');
							var t1 = setTimeout(goNextCard, 250);
							var t2 = setTimeout(function() {fc.classList.remove('moveUp');}, 500);
							break;
						case 'down':
							fc.classList.add('moveDown');
							var t1 = setTimeout(goBackCard, 250);
							var t2 = setTimeout(function() {fc.classList.remove('moveDown');}, 500);
							break;
					}
			}
		</script>
  </body>
</html>
